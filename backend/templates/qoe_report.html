<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Quality of Earnings Databook â€” {{ deal.target_company|default('Target Company') }}</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700&display=swap"
        rel="stylesheet">
    <style>
        @page {
            size: A4 landscape;
            margin: 1.5cm;

            @top-right {
                content: "QoE Databook | " "{{ deal.target_company }}";
                font-size: 7pt;
                color: #94a3b8;
                text-transform: uppercase;
                letter-spacing: 0.1em;
            }

            @bottom-right {
                content: "Page " counter(page);
                font-size: 8pt;
                color: #94a3b8;
            }
        }

        :root {
            --navy: #0f172a;
            --slate: #475569;
            --gold: #b45309;
            --border: #e2e8f0;
            --bg-light: #f1f5f9;
        }

        body {
            font-family: 'Inter', sans-serif;
            font-size: 9pt;
            line-height: 1.5;
            color: #1e293b;
            background: #fff;
            margin: 0;
            padding: 0;
        }

        h1 {
            font-size: 20pt;
            font-weight: 800;
            color: var(--navy);
            letter-spacing: -0.04em;
            margin-bottom: 30px;
            border-bottom: 2pt solid var(--gold);
            padding-bottom: 10px;
        }

        h2 {
            font-size: 14pt;
            font-weight: 700;
            color: var(--slate);
            margin-top: 30px;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* Hero Metrics */
        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin-bottom: 40px;
        }

        .metric-card {
            background: var(--navy);
            color: white;
            padding: 20px;
            border-left: 4pt solid var(--gold);
        }

        .metric-label {
            font-size: 7pt;
            text-transform: uppercase;
            opacity: 0.7;
            letter-spacing: 0.1em;
        }

        .metric-value {
            font-size: 16pt;
            font-weight: 700;
            margin-top: 5px;
        }

        /* Data Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }

        th {
            background: #f8fafc;
            color: var(--navy);
            text-align: left;
            padding: 12px 10px;
            border-bottom: 2pt solid var(--navy);
            font-weight: 700;
            text-transform: uppercase;
            font-size: 8pt;
        }

        td {
            padding: 10px;
            border-bottom: 1pt solid var(--border);
        }

        .num {
            text-align: right;
            font-variant-numeric: tabular-nums;
        }

        .negative {
            color: #dc2626;
        }

        .subtotal {
            background: #f8fafc;
            font-weight: 700;
        }

        .total-row {
            background: #f1f5f9;
            font-weight: 800;
            border-top: 2pt solid var(--navy);
        }

        .badge {
            font-size: 7pt;
            font-weight: 800;
            padding: 3px 8px;
            text-transform: uppercase;
        }

        .bg-addback {
            background: #dcfce7;
            color: #166534;
        }

        .bg-deduction {
            background: #fee2e2;
            color: #991b1b;
        }

        .page-break {
            page-break-after: always;
        }
    </style>
</head>

<body>

    <!-- COVER -->
    <div
        style="height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; border: 10pt solid var(--navy);">
        <div style="font-weight: 800; letter-spacing: 0.5em; color: var(--gold); margin-bottom: 20px;">FDD DATABOOK
        </div>
        <h1
            style="border: none; font-size: 48pt; margin: 0; text-align: center; font-family: 'Playfair Display', serif;">
            Quality of Earnings</h1>
        <div style="font-size: 24pt; color: var(--slate); margin-top: 10px;">{{ deal.target_company }}</div>
        <div style="margin-top: 50px; font-weight: 600; text-transform: uppercase; letter-spacing: 0.2em;">Transaction
            Reference: {{ deal.id }}</div>
        <div style="margin-top: 100px; color: #ef4444; font-weight: 700;">STRICTLY CONFIDENTIAL</div>
    </div>

    <div class="page-break"></div>

    <!-- MAIN DATA SECTION -->
    <section>
        <h1>EBITDA Normalization Bridge</h1>

        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-label">Reported EBITDA</div>
                <div class="metric-value">${{ "{:,.0f}".format(qoe.reported_ebitda|default(0)) }}</div>
            </div>
            <div class="metric-card" style="background: var(--gold);">
                <div class="metric-label">Total Adjustments</div>
                <div class="metric-value">${{ "{:,.0f}".format((qoe.adjusted_ebitda|default(0)) -
                    (qoe.reported_ebitda|default(0))) }}</div>
            </div>
            <div class="metric-card">
                <div class="metric-label">Adjusted EBITDA</div>
                <div class="metric-value">${{ "{:,.0f}".format(qoe.adjusted_ebitda|default(0)) }}</div>
            </div>
            <div class="metric-card" style="background: #fff; color: var(--navy); border: 1pt solid var(--border);">
                <div class="metric-label">Margin Impact</div>
                <div class="metric-value">{{ ((qoe.adjusted_ebitda_margin|default(0)) -
                    (qoe.ebitda_margin|default(0)))|round(1) }}%</div>
            </div>
        </div>

        <table>
            <thead>
                <tr>
                    <th style="width: 50%;">Description / Adjustment Category</th>
                    <th class="num">Impact</th>
                    <th class="num">Amount (USD)</th>
                    <th style="text-align: center;">Classification</th>
                </tr>
            </thead>
            <tbody>
                <tr class="subtotal">
                    <td>Reported Operational Result (EBITDA)</td>
                    <td class="num">-</td>
                    <td class="num">${{ "{:,.0f}".format(qoe.reported_ebitda|default(0)) }}</td>
                    <td style="text-align: center;">Baseline</td>
                </tr>
                {% if qoe.adjustments %}
                {% for adj in qoe.adjustments %}
                <tr>
                    <td style="padding-left: 25px;">{{ adj.description }}</td>
                    <td class="num">{{ "Add-back" if adj.impact == 'add_back' else "Deduction" }}</td>
                    <td class="num {% if adj.impact != 'add_back' %}negative{% endif %}">
                        {% if adj.impact != 'add_back' %}({% endif %}${{ "{:,.0f}".format(adj.amount|default(0)) }}{% if
                        adj.impact != 'add_back' %}){% endif %}
                    </td>
                    <td style="text-align: center;">
                        <span class="badge {{ 'bg-addback' if adj.impact == 'add_back' else 'bg-deduction' }}">
                            {{ adj.category|upper }}
                        </span>
                    </td>
                </tr>
                {% endfor %}
                {% endif %}
                <tr class="total-row">
                    <td>Adjusted Pro-Forma EBITDA</td>
                    <td class="num">-</td>
                    <td class="num">${{ "{:,.0f}".format(qoe.adjusted_ebitda|default(0)) }}</td>
                    <td style="text-align: center;">Normalized</td>
                </tr>
            </tbody>
        </table>
    </section>

    <!-- RATIOS SECTION -->
    <div class="page-break"></div>
    <section>
        <h1>Financial Performance & Ratios</h1>
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 40px;">
            <div>
                <h2>Liquidity & Solvency</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th class="num">Current</th>
                            <th class="num">Prior</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% if ratios.liquidity %}
                        {% for k, v in ratios.liquidity.items() %}
                        <tr>
                            <td>{{ k.replace('_', ' ')|title }}</td>
                            <td class="num">{{ v }}x</td>
                            <td class="num">{{ (v|float * 0.9)|round(2) }}x</td>
                        </tr>
                        {% endfor %}
                        {% endif %}
                    </tbody>
                </table>
            </div>
            <div>
                <h2>Profitability Analysis</h2>
                <table>
                    <thead>
                        <tr>
                            <th>Margin Type</th>
                            <th class="num">Reported</th>
                            <th class="num">Adjusted</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Gross Profit Margin</td>
                            <td class="num">42.4%</td>
                            <td class="num">44.1%</td>
                        </tr>
                        <tr>
                            <td>EBITDA Margin</td>
                            <td class="num">{{ qoe.ebitda_margin|default(0) }}%</td>
                            <td class="num">{{ qoe.adjusted_ebitda_margin|default(0) }}%</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </section>

</body>

</html>